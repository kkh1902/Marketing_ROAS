# -----------------------------------------------------------
# 1. 베이스 이미지 선택
#    python:3.10-slim → 가볍고, 실무에서 가장 많이 사용
#    Docker Hub에 있는 공식 이미지 기본 실행 환경을 갖춘 미리 준비된 OS 이미지
# -----------------------------------------------------------
FROM python:3.10-slim

# -----------------------------------------------------------
# 2. 컨테이너 내 작업 디렉토리를 지정
#    /app 폴더 내부에서 모든 작업이 진행됨
# -----------------------------------------------------------
WORKDIR /app

# -----------------------------------------------------------
# 3. requirements.txt 먼저 복사
#    이유: Docker 레이어 캐싱 → build 속도를 극적으로 줄임
# -----------------------------------------------------------
COPY kafka/producer/requirements.txt /app

# 시스템 패키지 설치
RUN apt-get update && apt-get install -y \
    build-essential \ 
    librdkafka-dev \
    && rm -rf /var/lib/apt/lists/*

# -----------------------------------------------------------
# 4. 필요한 패키지 설치
#    pip install -r requirements.txt
# -----------------------------------------------------------
RUN pip install --no-cache-dir -r requirements.txt

# -----------------------------------------------------------
# 5. 나머지 소스코드 모두 복사
# -----------------------------------------------------------
COPY kafka/producer/ .  
COPY utils/ ./utils/

# 디렉토리 생성?
RUN mkdir -p /app/logs/producer /app/data/producer

# -----------------------------------------------------------
# 6. 컨테이너 실행 시 수행할 명령
#    -m 옵션으로 패키지 경로 기반 실행
#    예: python -m kafka.producer.producer
# -----------------------------------------------------------
CMD ["python", "-m", "kafka.producer.main"]
