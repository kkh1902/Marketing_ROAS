version: 2

models:
  - name: int_hourly_agg
    description: "시간별 CTR 집계 테이블 (검증용, Flink와 다른 방식으로 집계)"
    columns:
      - name: event_date
        description: "이벤트 날짜"
        tests:
          - not_null

      - name: event_hour_timestamp
        description: "이벤트 시간 (YYYY-MM-DD HH:00:00 형식)"
        tests:
          - not_null

      - name: site_id
        description: "사이트 ID"
        tests:
          - not_null

      - name: site_domain
        description: "사이트 도메인"

      - name: site_category
        description: "사이트 카테고리"

      - name: device_type
        description: "디바이스 타입"

      - name: total_impressions
        description: "시간별 총 노출 수"
        tests:
          - not_null
          - relationships:
              to: ref('stg_ad_events')
              field: id

      - name: total_clicks
        description: "시간별 총 클릭 수"
        tests:
          - not_null

      - name: ctr_percentage
        description: "시간별 클릭률 (%)"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "ctr_percentage <= 100"

      - name: clicks_count
        description: "클릭 이벤트 개수"
        tests:
          - not_null

      - name: impressions_count
        description: "노출 이벤트 개수"
        tests:
          - not_null

      - name: has_clicks
        description: "클릭이 있었는지 여부"

      - name: no_clicks
        description: "클릭이 없었는지 여부"

      - name: dbt_loaded_at
        description: "dbt 처리 시간"
        tests:
          - not_null
